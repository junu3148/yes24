<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="transferboard">


	<!-- 양도표 등록 -->
	<insert id="insertTransferboard" parameterType="TransferBoardVO">
	
		<![CDATA[
		
			INSERT INTO transfer_board (
			                            transfer_board_sq ,
			                            hope_price ,
			                            transfer_stat ,
			                            transfer_board_content ,
			                            transfer_board_reg_date ,
			                            ticket_sq ,
			                            sell_user_sq
			                           ) 
			                     VALUES 
			                           (
			                            seq_transfer_board_sq.NEXTVAL ,
			                            #{hopePrice} ,
			                            'Y',
			                            #{transferBoardContent} ,
			                            SYSDATE ,
			                            #{ticketSq} ,
			                            #{sellUserSq}
                           			   )
				
		]]>

	</insert>

	<!-- 양도게시글 삭제 -->
	<delete id="deleteTransferboard" parameterType="int">
	
		<![CDATA[
		
			DELETE transfer_board WHERE transfer_board_sq = #{transferBoardSq}
		
		]]>

	</delete>

	<!-- 양도리스트가지고오기 -->
	<select id="getTransferboardList" resultType="TransferBoardVO">
	
	    <![CDATA[
	    
	          SELECT
				    z.transfer_board_sq        AS transferboardsq,
				    z.hope_price               AS hopeprice,
				    z.transfer_stat            AS transferstat,
				    z.transfer_board_content   AS transferboardcontent,
				    TO_CHAR(z.transfer_board_reg_date, 'YYYY.MM.DD') AS transferboardregdate,
				    a.ticket_seat              AS ticketseat,
				    z.ticket_sq                AS ticketsq,
				    z.sell_user_sq             AS sellusersq,
				    d.show_sq                  AS showsq,
				    d.sub_image                AS subimage,
				    d.show_name                AS showname
				FROM
				    transfer_board z
				    LEFT JOIN ticket a ON z.ticket_sq = a.ticket_sq
				    LEFT JOIN ticketing b ON a.ticketing_sq = b.ticketing_sq
				    LEFT JOIN showing c ON a.showing_sq = c.showing_sq
				    LEFT JOIN show d ON c.show_sq = d.show_sq
				ORDER BY
				    transfer_board_sq DESC
	    ]]>
	    
	</select>
	
	<!-- 양도게시판 정보 가져오기 -->
	<select id="getTransferboard" parameterType="int" resultType="TransferBoardVO">
	
		<![CDATA[
		
			      SELECT
					    a.transfer_board_sq        AS transferboardsq,
					    a.hope_price               AS hopeprice,
					    a.transfer_stat            AS transferstat,
					    a.transfer_board_content   AS transferboardcontent,
					    TO_CHAR(a.transfer_board_reg_date, 'YYYY.MM.DD') AS transferboardregdate,
					    b.ticket_seat              AS ticketseat,
					    a.ticket_sq                AS ticketsq,
					    a.sell_user_sq             AS sellusersq,
					    c.show_sq                  AS showsq,
                        d.user_id                  AS userid
					FROM
					    transfer_board a
					    LEFT JOIN ticket b ON a.ticket_sq = b.ticket_sq
					    LEFT JOIN showing c ON b.showing_sq = c.showing_sq
                        LEFT JOIN users d ON d.user_sq = a.sell_user_sq
				   WHERE 
				        a.transfer_board_sq = #{transferBoardSq}		
						
		]]>
	
	</select>
	
	
	<!-- 공연정보가져오기 -->
	<select id="getShow" parameterType="int" resultType="ShowVO">
		
		<![CDATA[

		      SELECT
				    show_sq AS showsq,
				    main_image AS mainimage,
				    sub_image AS subimage,
				    TO_CHAR(start_date, 'YYYY.MM.DD') AS startdate,
				    TO_CHAR(end_date, 'YYYY.MM.DD') AS enddate,
				    TO_CHAR(reservation_date, 'YYYY.MM.DD') AS reservationdate,
				    show_name AS showname,
				    cast,
				    director,
				    show_time AS showtime,
				    viewing_age AS viewingage,
				    show_content AS showcontent,
				    category,
				    show_stat AS showstat,
				    concert_hall_sq AS concerthallsq
				FROM
				    show
			   WHERE
				    show_sq = (
						        SELECT
						            c.show_sq   AS showsq
						        FROM
						            transfer_board z
						            INNER JOIN ticket a ON z.ticket_sq = a.ticket_sq
						            INNER JOIN ticketing b ON a.ticketing_sq = b.ticketing_sq
						            INNER JOIN showing c ON a.showing_sq = c.showing_sq
						        WHERE
						            z.transfer_board_sq = #{transferBoardSq}
						   	 )		
		
		]]>

	</select>
	
	<!-- 좌석클래스리스트 -->
	<select id="getSeatClassList" parameterType="int" resultType="SeatClassVO">
			
		<![CDATA[
		
			  SELECT
				    seat_class_sq   AS SEATCLASSSQ,
				    seat_class      AS SEATCLASS,
				    seat_price      AS SEATPRICE,
				    show_sq         AS SHOWSQ
				FROM
				    seat_class
			   WHERE
				    show_sq = (
						        SELECT
						            c.show_sq   AS showsq
						        FROM
						            transfer_board z
						            INNER JOIN ticket a ON z.ticket_sq = a.ticket_sq
						            INNER JOIN ticketing b ON a.ticketing_sq = b.ticketing_sq
						            INNER JOIN showing c ON a.showing_sq = c.showing_sq
						        WHERE
						            z.transfer_board_sq = #{transferBoardSq}
						    )
		    ORDER BY 
				    seat_price DESC    
		]]>
		
	</select>

</mapper>